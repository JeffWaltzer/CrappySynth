<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Synthesizer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background: #1a1a1a;
            color: white;
        }

        .keyboard {
            display: grid;
            grid-template-columns: repeat(12, 50px);
            gap: 5px;
            justify-content: center;
            margin-top: 20px;
        }

        .key {
            width: 50px;
            height: 150px;
            background: white;
            border: 1px solid black;
            border-radius: 5px;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            color: black;
            font-size: 12px;
            cursor: pointer;
            position: relative;
        }

        .key:active {
            background: #ddd;
        }

        .sharp {
            background: black;
            height: 100px;
            color: white;
            border: 1px solid black;
            position: absolute;
            top: 0;
            left: 35px;
            width: 30px;
            z-index: 1;
        }

        .sharp:active {
            background: #444;
        }
    </style>
</head>
<body>
<h1>Web Synthesizer</h1>
<label for="waveType">Waveform:</label>
<select id="synthType">
    <option value="subtractive">Subtractive</option>
    <option value="physical">Physical Modeling</option>
</select>
<label for="waveType">Waveform:</label>
<select id="waveType">
    <option value="sine">Sine</option>
    <option value="square">Square</option>
    <option value="triangle">Triangle</option>
    <option value="sawtooth">Sawtooth</option>
</select>

<div class="keyboard">
    <!-- White keys -->
    <div class="key" data-note="C4">C</div>
    <div class="key" data-note="D4">D</div>
    <div class="key" data-note="E4">E</div>
    <div class="key" data-note="F4">F</div>
    <div class="key" data-note="G4">G</div>
    <div class="key" data-note="A4">A</div>
    <div class="key" data-note="B4">B</div>
    <div class="key" data-note="C5">C</div>
    <div class="key" data-note="D5">D</div>
    <div class="key" data-note="E5">E</div>
    <div class="key" data-note="F5">F</div>
    <div class="key" data-note="G5">G</div>

    <!-- Black keys -->
    <div class="sharp" data-note="C#4"></div>
    <div class="sharp" data-note="D#4"></div>
    <div style="grid-column-start: 4;"></div>
    <div class="sharp" data-note="F#4"></div>
    <div class="sharp" data-note="G#4"></div>
    <div class="sharp" data-note="A#4"></div>
    <div style="grid-column-start: 8;"></div>
    <div class="sharp" data-note="C#5"></div>
    <div class="sharp" data-note="D#5"></div>

<div id="physicalModelingOptions" style="display: none; margin-top: 20px;">
    <label for="instrumentType">Instrument:</label>
    <select id="instrumentType">
        <option value="plucked">Plucked Strings</option>
        <option value="wind">Wind Instrument</option>
    </select>
</div>
</div>

<script>
    // Web Audio API setup
    let physicalSynth;
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    let oscillator;
    let gainNode = audioContext.createGain();
    gainNode.gain.setValueAtTime(0.5, audioContext.currentTime); // Set default volume
    gainNode.connect(audioContext.destination);

    // Note frequencies (equal temperament tuning)
    const noteFrequencies = {
        C4: 261.63, "C#4": 277.18, D4: 293.66, "D#4": 311.13, E4: 329.63, F4: 349.23,
        "F#4": 369.99, G4: 392.00, "G#4": 415.30, A4: 440.00, "A#4": 466.16, B4: 493.88,
        C5: 523.25, "C#5": 554.37, D5: 587.33, "D#5": 622.25, E5: 659.26, F5: 698.46,
        "F#5": 739.99, G5: 783.99
    };

    // Play a note
function playPhysicalSynth(note, instrument) {
    if (instrument === "plucked") {
        const frequency = noteFrequencies[note];
        const sampleRate = audioContext.sampleRate;
        const bufferSize = Math.floor(sampleRate / frequency);
        const decayFactor = 0.997; // Decay rate for the Karplus-Strong

        const buffer = new Float32Array(bufferSize).map(() => Math.random() * 2 - 1);
        const whiteNoise = audioContext.createBuffer(1, buffer.length, sampleRate);
        whiteNoise.copyToChannel(buffer, 0);

        const bufferSource = audioContext.createBufferSource();
        bufferSource.buffer = whiteNoise;

        const lowPassFilter = audioContext.createBiquadFilter();
        lowPassFilter.type = "lowpass";
        lowPassFilter.frequency.setValueAtTime(frequency * decayFactor, audioContext.currentTime);

        bufferSource.connect(lowPassFilter);
        lowPassFilter.connect(gainNode);

        bufferSource.start();
        console.log(`Plucked string triggered: ${note}`);

        setTimeout(() => bufferSource.stop(), 100);
    } else if (instrument === "wind") {
        const frequency = noteFrequencies[note];
        const baseOscillator = audioContext.createOscillator();
        const lfoOscillator = audioContext.createOscillator();
        const lfoGain = audioContext.createGain();

        baseOscillator.type = "sine";
        baseOscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);

        lfoOscillator.type = "sine";
        lfoOscillator.frequency.setValueAtTime(5, audioContext.currentTime); // LFO modulates at 5 Hz

        lfoGain.gain.setValueAtTime(10, audioContext.currentTime); // LFO intensity

        lfoOscillator.connect(lfoGain);
        lfoGain.connect(baseOscillator.frequency);
        baseOscillator.connect(gainNode);

        baseOscillator.start();
        lfoOscillator.start();

        console.log(`Wind instrument triggered: ${note}`);

        setTimeout(() => {
            baseOscillator.stop();
            lfoOscillator.stop();
        }, 500); // Wind sound plays for 500ms
    }
}
    function playNote(note, waveType) {
        const frequency = noteFrequencies[note];
        oscillator = audioContext.createOscillator();
        oscillator.type = waveType;
        oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
        oscillator.connect(gainNode);
        oscillator.start();
    }

    // Stop a note
    function stopNote() {
        if (oscillator) {
            oscillator.stop();
            oscillator.disconnect();
        }
    }

    // Handle key press
    const synthTypeSelect = document.getElementById("synthType");
    const physicalModelingOptions = document.getElementById("physicalModelingOptions");
    synthTypeSelect.addEventListener("change", () => {
        const synthType = synthTypeSelect.value;
        physicalModelingOptions.style.display = synthType === "physical" ? "block" : "none";
    });
    const keys = document.querySelectorAll(".key, .sharp");
    keys.forEach((key) => {
        key.addEventListener("mousedown", (event) => {
            const synthType = synthTypeSelect.value;
            const note = event.target.dataset.note;
            if (synthType === "physical") {
                const instrument = document.getElementById("instrumentType").value;
                playPhysicalSynth(note, instrument);
            } else {
            const note = event.target.dataset.note;
            const waveType = document.getElementById("waveType").value;
                playNote(note, waveType);
            }
        });

        key.addEventListener("mouseup", stopNote);
        key.addEventListener("mouseleave", stopNote); // Ensures note stops when you move the mouse away
    });

    // Handle Keyboard input for notes (optional)
    const keyMap = {
        65: "C4", 87: "C#4", 83: "D4", 69: "D#4", 68: "E4", 70: "F4", 84: "F#4",
        71: "G4", 89: "G#4", 72: "A4", 85: "A#4", 74: "B4", 75: "C5"
    };

    document.addEventListener("keydown", (event) => {
        const synthType = synthTypeSelect.value;
        const note = keyMap[event.keyCode];
        if (synthType === "physical") {
            const instrument = document.getElementById("instrumentType").value;
            if (note) playPhysicalSynth(note, instrument);
        } else {
        const note = keyMap[event.keyCode];
        const waveType = document.getElementById("waveType").value;
            if (note) playNote(note, waveType);
        }
    });

    document.addEventListener("keyup", stopNote);
</script>
</body>
</html>