<!DOCTYPE html>
<html lang="en">
<head>
    <script>
        const frequencies = {
            A: 220.0,  // Frequency for A
            "A#": 233.08, // Frequency for A#
            B: 246.94, // Frequency for B
            C: 261.63,  // Frequency for C
            "C#": 277.18, // Frequency for C#
            D: 293.66,  // Frequency for D
            "D#": 311.13, // Frequency for D#
            E: 329.63,  // Frequency for E
            F: 349.23,  // Frequency for F
            "F#": 369.99, // Frequency for F#
            G: 392.00,   // Frequency for G
            "G#": 415.30  // Frequency for G#
        };

        function playSynth(input) {
            console.log('playSynth:', input);
            let note, frequency;
            if (typeof input === 'number') { // Check if input is a MIDI note number
                const midiNumber = input;
                note = getNoteFromMIDINumber(midiNumber); // Convert MIDI number to note name
                const octave = Math.floor(midiNumber / 12) - 1; // Calculate octave
                frequency = 440 * Math.pow(2, (midiNumber - 69) / 12); // Convert MIDI to frequency
            } else { // If input is a note name
                note = input;
                frequency = frequencies[note] || 220.0; // Fallback to A if note is invalid
            }
            const selectedInstrument = document.getElementById("instrument").value;
            playInstrument(selectedInstrument, audioContext, frequency, 2);
        }

    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Physical Modeling Synthesizer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #282c34;
            color: white;
            text-align: center;
            margin: 0;
            padding: 20px;
        }

        button {
            transition: none;
        }

        h1 {
            margin-bottom: 30px;
        }

        button {
            padding: 15px 30px;
            margin: 10px;
            font-size: 18px;
            color: white;
            background-color: #61dafb;
            border: none;
            cursor: pointer;
            border-radius: 5px;
        }

        button:hover {
            background-color: #21a1f1;
        }
    </style>
</head>
<body>
<h1>Physical Modeling Synthesizer</h1>
<div>
    <label for="midiOutput">MIDI Device:</label>
    <select id="midiOutput">
        <option value="" selected>Select MIDI Device</option>
    </select>
</div>
<div>
    <label for="instrument">Select Instrument:</label>
    <select id="instrument">
        <option value="grandPiano" selected>Grand Piano</option>
        <option value="guitar">Guitar</option>
        <option value="flute">Flute</option>
        <option value="tubularBell">Tubular Bell</option>
        <option value="guitar">Guitar</option>
        <option value="violin" selected>Violin</option>
        <option value="marimba">Marimba</option>
    </select>
</div>
<div style="position: relative; width: 420px; height: 200px; margin: auto;">
    <div style="display: flex; position: absolute; bottom: 0; left: 0; right: 0; gap: 5px;">
        <button style="width: 37.5px; height: 90px; background: white; color: black; position: relative;"
                onclick="playSynth('C')">C &#9833;
        </button>
        <button style="width: 37.5px; height: 90px; background: white; color: black; position: relative;"
                onclick="playSynth('D')">D &#9834;
        </button>
        <button style="width: 37.5px; height: 90px; background: white; color: black; position: relative;"
                onclick="playSynth('E')">E &#9835;
        </button>
        <button style="width: 37.5px; height: 90px; background: white; color: black; position: relative;"
                onclick="playSynth('F')">F &#9836;
        </button>
        <button style="width: 37.5px; height: 90px; background: white; color: black; position: relative;"
                onclick="playSynth('G')">G &#9837;
        </button>
        <button style="width: 37.5px; height: 90px; background: white; color: black; position: relative;"
                onclick="playSynth('A')">A &#9838;
        </button>
        <button style="width: 37.5px; height: 90px; background: white; color: black; position: relative;"
                onclick="playSynth('B')">B &#9839;
        </button>
    </div>
    <div style="display: flex; position: absolute; bottom: 80px; left: 28px; gap: 10px;">
        <button style="width: 18.75px; height: 60px; background: black; color: white; z-index: 1;"
                onclick="playSynth('C#')">C#
        </button>
        <button style="width: 18.75px; height: 60px; background: black; color: white; z-index: 1; margin-left: 25.5px;"
                onclick="playSynth('D#')">D#
        </button>
        <div style="flex: 1;"></div>
        <button style="width: 18.75px; height: 60px; background: black; color: white; z-index: 1;"
                onclick="playSynth('F#')">F#
        </button>
        <button style="width: 18.75px; height: 60px; background: black; color: white; z-index: 1; margin-left: 25.5px;"
                onclick="playSynth('G#')">G#
        </button>
        <button style="width: 18.75px; height: 60px; background: black; color: white; z-index: 1; margin-left: 25.5px;"
                onclick="playSynth('A#')">A#
        </button>
    </div>
</div>
<div>
    <button onclick="playCChord()">C Major (C–E–G)</button>

    <button onclick="playDChord()">D Major (D–F#–A)</button>

    <button onclick="playEChord()">E Major (E–G#–B)</button>

    <button onclick="playFChord()">F Major (F–A–C)</button>

    <button onclick="playGChord()">G Major (G–B–D)</button>

    <button onclick="playAChord()">A Major (A–C#–E)</button>

    <button onclick="playBChord()">B Major (B–D#–F#)</button>
    <hr/>
    <button onclick="playCmChord()">C Minor (C–D#–G)</button>

    <button onclick="playDmChord()">D Minor (D–F–A)</button>

    <button onclick="playEmChord()">E Minor (E–G–B)</button>

    <button onclick="playFmChord()">F Minor (F–G#–C)</button>

    <button onclick="playGmChord()">G Minor (G–A#–D)</button>

    <button onclick="playAmChord()">A Minor (A–C–E)</button>

    <button onclick="playBmChord()">B Minor (B–D–F#)</button>
    <hr/>
    <button onclick="playA7Chord()">A7 (A–C#–E–G)</button>
    <button onclick="playF7Chord()">F7 (F–A–C–Eb)</button>
    <button onclick="playFmaj7Chord()">Fmaj7 (F–A–C–E)</button>
    <button onclick="playAm7Chord()">Am7 (A–C–E–G)</button>
</div>
<script>
    // Initialize Audio Context
    if (navigator.requestMIDIAccess) {
        navigator.requestMIDIAccess().then(initMIDI, onMIDIFailure);
    } else {
        console.log("Web MIDI API not supported in this browser.");
    }

    function initMIDI(midiAccess) {
        updateMIDIDeviceList(midiAccess);
        midiAccess.outputs.forEach(output => availableOutputs.set(output.id, output));
        midiAccess.inputs.forEach((input) => {
            input.onmidimessage = handleMIDIMessage;
        });
    }

    function onMIDIFailure() {
        alert("Failed to access MIDI devices.");
    }

    function getNoteFromMIDINumber(note) {
        const notes = [
            "C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"
        ];
        return notes[note % 12];
    }

    function handleMIDIMessage(message) {
        console.dir(message);
        const [status, data1, data2] = message.data;
        const command = status >> 4;
        const note = data1;
        const velocity = data2;

        if (command === 9 && velocity > 0) {
            playSynth(note);
        }
    }

    function updateMIDIDeviceList(midiAccess) {
        const midiOutputSelect = document.getElementById("midiOutput");
        midiOutputSelect.innerHTML = '<option value="">Select MIDI Device</option>';
        midiAccess.outputs.forEach(output => {
            const option = document.createElement("option");
            option.value = output.id;
            option.textContent = output.name;
            midiOutputSelect.appendChild(option);
        });
    }

    const audioContext = new (window.AudioContext || window.webkitAudioContext)({sampleRate: 48000});
    const availableOutputs = new Map();

    function sendMIDINoteOn(output, noteNumber, velocity = 127) {
        const noteOnMessage = [0x90, noteNumber, velocity];
        console.log(noteOnMessage);
        output.send(noteOnMessage);
    }

    function sendMIDINoteOff(output, noteNumber) {
        const noteOffMessage = [0x80, noteNumber, 0];
        output.send(noteOffMessage);
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    }

    // Flute Sound Generation with Resonance and Sine Wave
    function fluteSound(ctx, frequency, duration) {
        const oscillator = createOscillator(ctx, "sine", frequency, -10);
        const bandpass = ctx.createBiquadFilter(); // Add resonance with bandpass filter
        bandpass.type = "bandpass";
        bandpass.frequency.setValueAtTime(frequency, ctx.currentTime);
        bandpass.Q.setValueAtTime(12, ctx.currentTime); // Set quality factor for resonance

        // Amplitude Envelope
        const gain = ctx.createGain();
        gain.gain.setValueAtTime(0, ctx.currentTime);
        gain.gain.linearRampToValueAtTime(0.8, ctx.currentTime + 0.1); // Attack
        gain.gain.exponentialRampToValueAtTime(0.7, ctx.currentTime + 0.4); // Decay
        gain.gain.setValueAtTime(0.6, ctx.currentTime + duration - 0.2); // Sustain
        gain.gain.linearRampToValueAtTime(0.0, ctx.currentTime + duration + 0.05); // Release

        oscillator.connect(bandpass); // Connect oscillator to bandpass filter
        bandpass.connect(gain); // Connect bandpass filter to gain
        gain.connect(ctx.destination);

        oscillator.start();
        oscillator.stop(ctx.currentTime + duration); // Stop after the specified duration
    }

    function tubularBellSound(ctx, frequency, duration) {
        const baseOscillator = createOscillator(ctx, "sine", frequency); // Base tone
        const firstHarmonic = createOscillator(ctx, "sine", frequency * 2.1); // Higher harmonic
        const secondHarmonic = createOscillator(ctx, "sine", frequency * 3.2); // Another harmonic

        // Amplitude envelope for decay
        const gain = ctx.createGain();
        gain.gain.setValueAtTime(0, ctx.currentTime);
        gain.gain.linearRampToValueAtTime(1.0, ctx.currentTime + 0.05); // Quick attack
        gain.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + duration); // Long decay

        // Resonating filter for bell-like effect
        const resonantFilter = ctx.createBiquadFilter();
        resonantFilter.type = "bandpass";
        resonantFilter.frequency.setValueAtTime(frequency, ctx.currentTime);
        resonantFilter.Q.setValueAtTime(15, ctx.currentTime); // High resonance for distinct tone

        // Connecting oscillators through the filter and gain
        baseOscillator.connect(resonantFilter);
        firstHarmonic.connect(resonantFilter);
        secondHarmonic.connect(resonantFilter);
        resonantFilter.connect(gain);
        gain.connect(ctx.destination);

        baseOscillator.start();
        firstHarmonic.start();
        secondHarmonic.start();

        baseOscillator.stop(ctx.currentTime + duration);
        firstHarmonic.stop(ctx.currentTime + duration);
        secondHarmonic.stop(ctx.currentTime + duration);
    }

    // Function to Play a Note
    // Guitar Sound Generation
    function playCChord() {
        const cFrequency = 261.63; // C4
        const eFrequency = 329.63; // E4
        const gFrequency = 392.00; // G4
        const chordDuration = 2;
        const selectedInstrument = document.getElementById("instrument").value;
        playChord(selectedInstrument, audioContext, [cFrequency, eFrequency, gFrequency], chordDuration);
    }

    function playGChord() {
        const gFrequency = 196.00; // G3
        const bFrequency = 246.94; // B3
        const dFrequency = 293.66; // D4
        const chordDuration = 2;
        const selectedInstrument = document.getElementById("instrument").value;
        playChord(selectedInstrument, audioContext, [gFrequency, bFrequency, dFrequency], chordDuration);
    }

    function playFChord() {
        const fFrequency = 174.61; // F3
        const aFrequency = 220.00; // A3
        const cFrequency = 261.63; // C4
        const chordDuration = 2;
        const selectedInstrument = document.getElementById("instrument").value;
        playChord(selectedInstrument, audioContext, [fFrequency, aFrequency, cFrequency], chordDuration);
    }

    function playFmChord() {
        const fFrequency = 174.61; // F3
        const aFlatFrequency = 207.65; // Ab3
        const cFrequency = 261.63; // C4
        const chordDuration = 2;
        const selectedInstrument = document.getElementById("instrument").value;
        playChord(selectedInstrument, audioContext, [fFrequency, aFlatFrequency, cFrequency], chordDuration);
    }


    function playDChord() {
        const dFrequency = 293.66; // D4
        const fSharpFrequency = 369.99; // F#4
        const aFrequency = 440.00; // A4
        const chordDuration = 2;
        const selectedInstrument = document.getElementById("instrument").value;
        playChord(selectedInstrument, audioContext, [dFrequency, fSharpFrequency, aFrequency], chordDuration);
    }

    function playEChord() {
        const eFrequency = 329.63; // E4
        const gSharpFrequency = 415.30; // G#4
        const bFrequency = 493.88; // B4
        const chordDuration = 2;
        const selectedInstrument = document.getElementById("instrument").value;
        playChord(selectedInstrument, audioContext, [eFrequency, gSharpFrequency, bFrequency], chordDuration);
    }

    function playBChord() {
        const bFrequency = 246.94; // B3
        const dSharpFrequency = 311.13; // D#4
        const fSharpFrequency = 369.99; // F#4
        const chordDuration = 2;
        const selectedInstrument = document.getElementById("instrument").value;
        playChord(selectedInstrument, audioContext, [bFrequency, dSharpFrequency, fSharpFrequency], chordDuration);
    }

    function playDmChord() {
        const dFrequency = 293.66; // D4
        const fFrequency = 349.23; // F4
        const aFrequency = 440.00; // A4
        const chordDuration = 2;
        const selectedInstrument = document.getElementById("instrument").value;
        playChord(selectedInstrument, audioContext, [dFrequency, fFrequency, aFrequency], chordDuration);
    }

    function playAChord() {
        const aFrequency = 220.00; // A3
        const cSharpFrequency = 277.18; // C#4
        const eFrequency = 329.63; // E4
        const chordDuration = 2; // 2 seconds
        const selectedInstrument = document.getElementById("instrument").value;
        playChord(selectedInstrument, audioContext, [aFrequency, cSharpFrequency, eFrequency], chordDuration);
    }

    function playA7Chord() {
        const aFrequency = 220.00; // A3
        const cSharpFrequency = 277.18; // C#4
        const eFrequency = 329.63; // E4
        const gFrequency = 392.00; // G4
        const chordDuration = 2; // 2 seconds
        const selectedInstrument = document.getElementById("instrument").value;
        playChord(selectedInstrument, audioContext, [aFrequency, cSharpFrequency, eFrequency, gFrequency], chordDuration);
    }

    function playFmaj7Chord() {
        const fFrequency = 174.61; // F3
        const aFrequency = 220.00; // A3
        const cFrequency = 261.63; // C4
        const eFrequency = 329.63; // E4
        const chordDuration = 2;
        const selectedInstrument = document.getElementById("instrument").value;
        playChord(selectedInstrument, audioContext, [fFrequency, aFrequency, cFrequency, eFrequency], chordDuration);
    }

    function playAm7Chord() {
        const aFrequency = 220.00; // A3
        const cFrequency = 261.63; // C4
        const eFrequency = 329.63; // E4
        const gFrequency = 392.00; // G4
        const chordDuration = 2;
        const selectedInstrument = document.getElementById("instrument").value;
        playChord(selectedInstrument, audioContext, [aFrequency, cFrequency, eFrequency, gFrequency], chordDuration);
    }

    function playF7Chord() {
        const fFrequency = 174.61; // F3
        const aFrequency = 220.00; // A3
        const cFrequency = 261.63; // C4
        const eFlatFrequency = 311.13; // Eb4
        const chordDuration = 2;
        const selectedInstrument = document.getElementById("instrument").value;
        playChord(selectedInstrument, audioContext, [fFrequency, aFrequency, cFrequency, eFlatFrequency], chordDuration);
    }


    function playGmChord() {
        const eFrequency = 164.81; // E3
        const gFrequency = 196.00; // G3
        const bFrequency = 246.94; // B3
        const chordDuration = 2; // 2 seconds
        const selectedInstrument = document.getElementById("instrument").value;
        playChord(selectedInstrument, audioContext, [eFrequency, gFrequency, bFrequency], chordDuration);
    }

    function playBmChord() {
        const bFrequency = 246.94; // B3
        const dFrequency = 293.66; // D4
        const fSharpFrequency = 369.99; // F#4
        const chordDuration = 2; // 2 seconds
        const selectedInstrument = document.getElementById("instrument").value;
        playChord(selectedInstrument, audioContext, [bFrequency, dFrequency, fSharpFrequency], chordDuration);
    }

    function playEmChord() {
        const eFrequency = 329.63; // E4
        const gFrequency = 392.00; // G4
        const bFrequency = 246.94; // B3
        const chordDuration = 2; // 2 seconds
        const selectedInstrument = document.getElementById("instrument").value;
        playChord(selectedInstrument, audioContext, [eFrequency, gFrequency, bFrequency], chordDuration);
    }


    function playAmChord() {
        const aFrequency = 220.00; // A3
        const cFrequency = 261.63; // C4
        const eFrequency = 329.63; // E4
        const chordDuration = 2; // 2 seconds
        const selectedInstrument = document.getElementById("instrument").value;
        playChord(selectedInstrument, audioContext, [aFrequency, cFrequency, eFrequency], chordDuration);
    }

    function playCmChord() {
        const cFrequency = 261.63; // C4
        const dSharpFrequency = 311.13; // D#4
        const gFrequency = 392.00; // G4
        const chordDuration = 2; // 2 seconds
        const selectedInstrument = document.getElementById("instrument").value;
        playChord(selectedInstrument, audioContext, [cFrequency, dSharpFrequency, gFrequency], chordDuration);
    }

    function guitarSound(ctx, frequency, duration) {
        const oscillator = createOscillator(ctx, "sawtooth", frequency);

        const detunedOscillator = createOscillator(ctx, "sawtooth", frequency, -12); // Enhance with detuned harmonic oscillator

        const gain = ctx.createGain();
        gain.gain.setValueAtTime(0, ctx.currentTime);
        gain.gain.linearRampToValueAtTime(1.0, ctx.currentTime + 0.02); // Quick attack
        gain.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + duration); // Quick decay to mimic pluck

        // Body resonance effect for pluck
        const bodyFilter = ctx.createBiquadFilter();
        bodyFilter.type = "lowpass";
        bodyFilter.frequency.setValueAtTime(2200, ctx.currentTime); // High frequency for initial brightness
        bodyFilter.frequency.exponentialRampToValueAtTime(800, ctx.currentTime + duration); // Frequency drop for realism

        // Physical resonance simulation
        const resonance = ctx.createConvolver();
        const impulse = ctx.createBuffer(2, ctx.sampleRate / 2, ctx.sampleRate); // Simulated impulse response
        const left = impulse.getChannelData(0);
        const right = impulse.getChannelData(1);
        for (let i = 0; i < left.length; i++) {
            left[i] = (Math.random() * 2 - 1) * Math.pow(1 - i / left.length, 2); // Damped random signal
            right[i] = (Math.random() * 2 - 1) * Math.pow(1 - i / right.length, 2); // Damped random signal
        }
        resonance.buffer = impulse;

        oscillator.connect(bodyFilter);
        detunedOscillator.connect(bodyFilter); // Connect detuned oscillator
        bodyFilter.connect(resonance);
        resonance.connect(gain);
        gain.connect(ctx.destination);

        oscillator.start();
        detunedOscillator.start(); // Start detuned oscillator
        oscillator.stop(ctx.currentTime + duration); // Stop after the specified duration
        detunedOscillator.stop(ctx.currentTime + duration); // Stop detuned oscillator
    }


    function playInstrument(instrument, ctx, frequency, duration) {
        const instruments = {
            flute: fluteSound,
            tubularBell: tubularBellSound,
            marimba: marimbaSound,
            guitar: guitarSound,
            grandPiano: enhancedPianoSound,
            violin: violinSound,
        };
        const playFn = instruments[instrument];
        if (playFn) {
            playFn(ctx, frequency, duration);
        }
    }

    function adjustGainForChord(playFn, gain, duration, ctx) {
        const gainNode = ctx.createGain();
        gainNode.gain.setValueAtTime(gain, ctx.currentTime);
        gainNode.gain.linearRampToValueAtTime(gain, ctx.currentTime + duration);
        gainNode.connect(ctx.destination);
        playFn();
    }

    function playChord(instrument, ctx, frequencies, duration) {
        const normalizedGain = 1 / Math.sqrt(frequencies.length); // Normalize combined amplitude
        var normalizedDuration = 2;
        frequencies.forEach((freq) => {
            const instrumentSound = () => playInstrument(instrument, ctx, freq, normalizedDuration);
            adjustGainForChord(instrumentSound, normalizedGain, normalizedDuration, ctx);
        });

        frequencies.forEach((freq) => playInstrument(instrument, ctx, freq, normalizedDuration));
    }

    function createOscillator(ctx, type, frequency, detune = 0) {
        const oscillator = ctx.createOscillator();
        oscillator.type = type;
        oscillator.frequency.setValueAtTime(frequency, ctx.currentTime);
        oscillator.detune.value = detune;
        return oscillator;
    }

    function marimbaSound(ctx, frequency, duration) {
        const oscillator = ctx.createOscillator();
        oscillator.type = "square"; // Square wave for percussive tone
        oscillator.frequency.setValueAtTime(frequency, ctx.currentTime);

        // Amplitude Envelope
        const gain = ctx.createGain();
        gain.gain.setValueAtTime(0, ctx.currentTime);
        gain.gain.linearRampToValueAtTime(1.2, ctx.currentTime + 0.02); // Quick attack for percussive sound
        gain.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + duration); // Rapid decay for short marimba notes

        // Filter for marimba tone shaping
        const bandpass = ctx.createBiquadFilter();
        bandpass.type = "bandpass";
        bandpass.frequency.setValueAtTime(frequency, ctx.currentTime);
        bandpass.Q.setValueAtTime(8, ctx.currentTime); // Moderate quality for defined tone

        oscillator.connect(bandpass);
        bandpass.connect(gain);
        gain.connect(ctx.destination);

        oscillator.start();
        oscillator.stop(ctx.currentTime + duration); // Stop after the specified duration
    }

    // Violin Sound Generation
    function violinSound(ctx, frequency, duration) {
        const baseGain = ctx.createGain();
        baseGain.gain.setValueAtTime(0, ctx.currentTime);
        baseGain.gain.linearRampToValueAtTime(1.0, ctx.currentTime + 0.1); // Attack
        baseGain.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + duration); // Decay

        const detuneOffset = 0;//(i === 0 ? 0 : i === 1 ? -5 : 5); // Slight detune for realism
        const oscillator = createOscillator(ctx, "sawtooth", frequency, detuneOffset);
        oscillator.frequency.setValueAtTime(frequency, ctx.currentTime);

        const filter = ctx.createBiquadFilter();
        filter.type = "lowpass";
        filter.frequency.setValueAtTime(5000, ctx.currentTime); // Warm tone
        filter.Q.setValueAtTime(1, ctx.currentTime);

        oscillator.connect(filter);
        filter.connect(baseGain);
        baseGain.connect(ctx.destination);

        oscillator.start();
        oscillator.stop(ctx.currentTime + duration);
    }

    // Enhanced Grand Piano Sound Generation
    function enhancedPianoSound(ctx, frequency, duration) {
        const baseGain = ctx.createGain();
        baseGain.gain.setValueAtTime(0, ctx.currentTime);
        baseGain.gain.linearRampToValueAtTime(1.0, ctx.currentTime + 0.03); // Quick attack
        baseGain.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + duration); // Long decay

        const fundamentalOscillator = createOscillator(ctx, "sine", frequency);
        const firstHarmonicOscillator = createOscillator(ctx, "sine", frequency * 2);
        const secondHarmonicOscillator = createOscillator(ctx, "sine", frequency * 4, 5); // Slight detune for richness

        const filter = ctx.createBiquadFilter();
        filter.type = "lowpass";
        filter.frequency.setValueAtTime(6000, ctx.currentTime); // Warm tone
        filter.Q.setValueAtTime(1, ctx.currentTime);

        fundamentalOscillator.connect(filter);
        firstHarmonicOscillator.connect(filter);
        secondHarmonicOscillator.connect(filter);
        filter.connect(baseGain);
        baseGain.connect(ctx.destination);

        fundamentalOscillator.start();
        firstHarmonicOscillator.start();
        secondHarmonicOscillator.start();

        fundamentalOscillator.stop(ctx.currentTime + duration);
        firstHarmonicOscillator.stop(ctx.currentTime + duration);
        secondHarmonicOscillator.stop(ctx.currentTime + duration);
    }
</script>
</body>
</html>